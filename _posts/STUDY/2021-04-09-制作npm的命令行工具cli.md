---
title:  "åˆ¶ä½œnpmçš„å‘½ä»¤è¡Œå·¥å…·cli"
date:   2021-04-09
desc: "ç»å¸¸ä½¿ç”¨npm installå®‰è£…ä¸€äº›ç»ˆç«¯èƒ½å¤Ÿè¿è¡Œçš„å‘½ä»¤ï¼Œæ¯”å¦‚eslintï¼Œvue-cliï¼Œäºæ˜¯è‡ªå·±æƒ³ç€ç ”ç©¶ä¸‹åŸç†ï¼Œè‡ªå·±è¯•ç€åšä¸€ä¸ªcliå‘½ä»¤è¡Œå·¥å…·"
keywords: "npm, nodejs, cli, git-hooks"
categories: [Tech, Study]
tags: [npm, nodejs, cli, git-hooks]
---

**npm**ï¼šnodejs packect manageï¼Œå…è®¸ç”¨æˆ·ä»NPMæœåŠ¡å™¨ä¸‹è½½åˆ«äººç¼–å†™çš„ç¬¬ä¸‰æ–¹åŒ…åˆ°æœ¬åœ°ä½¿ç”¨ã€ä¸‹è½½å¹¶å®‰è£…åˆ«äººç¼–å†™çš„å‘½ä»¤è¡Œç¨‹åºï¼ˆCLIï¼‰åˆ°æœ¬åœ°ä½¿ç”¨ã€å°†è‡ªå·±ç¼–å†™çš„åŒ…æˆ–å‘½ä»¤è¡Œç¨‹åºä¸Šä¼ åˆ°NPMæœåŠ¡å™¨ä¾›åˆ«äººä½¿ç”¨ã€‚

**cli**ï¼šcommand line interfaceï¼Œå‘½ä»¤è¡Œç•Œé¢ï¼Œæ˜¯æŒ‡å¯åœ¨ç”¨æˆ·æç¤ºç¬¦ä¸‹é”®å…¥å¯æ‰§è¡ŒæŒ‡ä»¤çš„ç•Œé¢ï¼Œ

ä¸€ç›´çŸ¥é“npm installä¸€äº›å·¥å…·ä¹‹åï¼Œè‡ªå·±å°±èƒ½åœ¨ç»ˆç«¯ä½¿ç”¨ï¼Œä½†æ˜¯ä¸€ç›´ä¸äº†è§£åŸç†ï¼Œåæ¥æ‰çŸ¥é“è¿™æ˜¯npmåŒ…çš„å‘å¸ƒå’Œcliå·¥å…·çš„ç»“åˆ

## NodeåŒ…ç®¡ç†å™¨

nodeåŒ…ç®¡ç†å’ŒiOSçš„podå¾ˆåƒï¼Œä¸»è¦å®ç°çš„ç›®çš„å°±æ˜¯è§£å†³å¤šäººåä½œä¸­çš„ç»„ä»¶åº“/æ¨¡å—å¤ç”¨çš„é—®é¢˜ï¼Œå½“ç„¶nodeåŒ…ç®¡ç†è¿˜èƒ½å’Œcliç»“åˆä½¿ç”¨çš„å¥½å¤„ã€‚

ä¸€èˆ¬å…¬å¸éƒ½æœ‰è‡ªå·±çš„[NPMç®¡ç†å¹³å°](http://yx.mail.netease.com/wiki/#/doc/319334)ï¼ˆä¸åšè¿‡å¤šä»‹ç»ï¼‰ï¼Œå®˜æ–¹çš„ç®¡ç†å¹³å°æ˜¯[npmjs](https://www.npmjs.com/)ï¼Œè¿™é‡Œæœ‰æˆåƒä¸Šä¸‡çš„å¼€æºçš„æ¨¡å—ï¼Œä½ åªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼Œå°±èƒ½ä½¿ç”¨åˆ«äººå†™å¥½çš„æ¨¡å—ã€‚

## åˆ›å»ºç¬¬ä¸€ä¸ªnodeæ¨¡å—

ä½¿ç”¨npm initå‘½ä»¤å³å¯åˆ›å»ºï¼Œå¦‚ä¸‹ï¼š

```shell
nodejs|â‡’ mkdir npm-module
nodejs|â‡’ cd npm-module
npm-module|â‡’ npm init
This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.

See `npm help json` for definitive documentation on these fields
and exactly what they do.

Use `npm install <pkg>` afterwards to install a package and
save it as a dependency in the package.json file.

Press ^C at any time to quit.
package name: (npm-module)
version: (1.0.0)
description: åˆ¶ä½œnpmçš„å‘½ä»¤è¡Œå·¥å…·cli
entry point: (index.js)
test command:
git repository:
keywords: npm cli
author: rambo
license: (ISC)
About to write to /Users/rambo/Documents/MyProject/nodejs/npm-module/package.json:

{
  "name": "npm-module",
  "version": "1.0.0",
  "description": "åˆ¶ä½œnpmçš„å‘½ä»¤è¡Œå·¥å…·cli",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [
    "npm",
    "cli"
  ],
  "author": "rambo",
  "license": "ISC"
}


Is this OK? (yes) yes
npm-module|â‡’ ll
total 8
-rw-r--r--  1 rambo  staff  283  4 12 15:59 package.json
npm-module|â‡’ cat package.json
{
  "name": "npm-module",
  "version": "1.0.0",
  "description": "åˆ¶ä½œnpmçš„å‘½ä»¤è¡Œå·¥å…·cli",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [
    "npm",
    "cli"
  ],
  "author": "rambo",
  "license": "ISC"
}
npm-module|â‡’vim index.js
exports.showMsg = function () {
        console.log("è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªnodeæ¨¡å—");
};
npm-module|â‡’ ll
total 16
-rw-r--r--  1 rambo  staff   84  4 12 16:10 index.js
-rw-r--r--  1 rambo  staff  283  4 12 15:59 package.json
npm-module|â‡’
```

åˆ°æ­¤ï¼Œæˆ‘ä»¬å°±ç¼–å†™å®Œäº†ä¸€ä¸ªnpmåŒ…ã€‚

## å‘å¸ƒåŒ…åˆ°npmjsï¼Œå¹¶ä½¿ç”¨

1. æ³¨å†Œnpmè´¦å·ï¼Œå»[å®˜ç½‘](https://www.npmjs.com/)æ³¨å†Œæˆ–æ˜¯ä½¿ç”¨npm adduserå‘½ä»¤è¡Œæ³¨å†Œ

2. ç™»å½•ï¼Œé¦–æ¬¡éœ€è¦ï¼Œnpm loginä¼šå°†è¯ä¹¦ä¿å­˜åˆ°æœ¬åœ°ï¼Œåé¢å°±ä¸éœ€è¦æ¯æ¬¡éƒ½ç™»å½•äº†

   ```shell
   npm-module|â‡’ npm login
   Username: ramboq
   Password:
   Email: (this IS public) qiujunyun@163.com
   Logged in as ramboq on http://npm.mail.netease.com/registry/.
   ```

3. å¼€å§‹å‘å¸ƒ npm publish

   ä¸æƒ³å‘å¸ƒçš„å†…å®¹æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡.gitignoreæˆ–æ˜¯.npmignoreæ–‡ä»¶è¿›è¡Œå¿½ç•¥

   > ä½¿ç”¨ cnpm çš„æ³¨æ„æŠ¥é”™ï¼š
   > no_perms Private mode enable, only admin can publish this module
   > è®¾ç½®å›åŸæœ¬çš„å°±å¯ä»¥äº†
   > **npm config set registry [registry.npmjs.org](http://registry.npmjs.org)** 
   > å‘å¸ƒå®Œæˆä¹‹å,å¦‚æœè¿˜æƒ³å›åˆ°ä¹‹å‰çš„cnpm,ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤
   > **npm config set registry [registry.npm.taobao.org](https://registry.npm.taobao.org)**

4. åˆ›å»ºæ¡ˆä¾‹ï¼Œå¹¶åº”ç”¨åˆšä¸Šä¼ çš„åŒ…

   åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­npm install npm-moduleå³å¯

   ```shell
   npm-module|â‡’ npm publish
   npm notice 
   npm notice ğŸ“¦  npm-module@1.0.0
   npm notice === Tarball Contents === 
   npm notice 283B   package.json
   npm notice 84B    index.js
   npm notice === Tarball Details === 
   npm notice name:          npm-module                         
   npm notice version:       1.0.0                                   
   npm notice package size:  1.1 kB                                  
   npm notice unpacked size: 2.8 kB                                 
   npm notice shasum:        5667da556208b
   npm notice integrity:     UE9w==
   npm notice total files:   2                                       
   npm notice 
   + npm-module@1.0.0
   ```

   

## æ·»åŠ CLIèƒ½åŠ›

å›åˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç»§ç»­ç¼–è¾‘`package.json`æ–‡ä»¶ï¼Œè¦æƒ³å®ç°clièƒ½åŠ›ï¼Œå…³é”®çš„æ˜¯é…ç½®`bin`å±æ€§ï¼Œè¯¥å±æ€§å¯¹åº”çš„æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚ä¾‹å¦‚å°† `bin` å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„é…ç½®ä¸ºå½“å‰é¡¹ç›®ä¸‹çš„ `./cli.js`ã€‚

```json
"bin": {   
		// rambo æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¯¥å‘½ä»¤æŒ‡å‘äº† ./cli.js è„šæœ¬
    "rambo": "./cli.js"
 }
```

```shell
npm-module|â‡’ ll
total 16
-rw-r--r--  1 rambo  staff    0  4 12 16:29 cli.js
-rw-r--r--  1 rambo  staff   84  4 12 16:10 index.js
-rw-r--r--  1 rambo  staff  323  4 12 16:29 package.json
```

æˆ‘ä»¬ç®€å•ç¼–è¾‘ä¸‹`cli.js`ï¼Œè®©ä»–è°ƒç”¨`index.js`

```shell
npm-module|â‡’ vim cli.js
#!/usr/bin/env node
var test = require('./index');
test.showMsg();
```

> åœ¨ env ä¸­åŒ…å«äº†ä¸€äº›ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬æˆ‘ä»¬å®‰è£…çš„ä¸€äº›è½¯ä»¶æ‰§è¡Œè·¯å¾„ç­‰ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ env æ¥æ‰¾åˆ°ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„ Node æ‰§è¡Œè·¯å¾„ï¼Œä»è€Œè®©æ–‡ä»¶å¯è¢«æ­£å¸¸çš„è§£é‡Šå’Œæ‰§è¡Œã€‚

## è½¯é“¾æ¥è¿›è¡Œæµ‹è¯•

ä½¿ç”¨`npm link`å‘½ä»¤å°†ä»–è¿æ¥åˆ°å…¨å±€æ‰§è¡Œç¯å¢ƒï¼Œè¿™æ ·åœ¨ç³»ç»Ÿçš„ä»»æ„è·¯å¾„ä¸‹é¢éƒ½èƒ½ä½¿ç”¨è¯¥cliå·¥å…·ã€‚

```shell
npm-module|â‡’ sudo npm link
Password:
npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN npm-module@1.0.0 No repository field.

up to date in 0.099s
/usr/local/bin/rambo -> /usr/local/lib/node_modules/npm-module/cli.js
/usr/local/lib/node_modules/npm-module -> /Users/rambo/Documents/MyProject/nodejs/npm-module
```

å½“æ‰§è¡Œ `npm link` åï¼Œå¯ä»¥çœ‹åˆ°åœ¨ Mac ä¸‹è¯¥å‘½ä»¤ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š

- ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ `./cli.js` åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œå°†å…¶é“¾æ¥åˆ° `/usr/local/bin/<package>`
- ä¸ºå½“å‰é¡¹ç›®åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œå°†å…¶é“¾æ¥åˆ° `/usr/local/lib/node_modules/<package>`

å› æ­¤åœ¨å…¨å±€ç¯å¢ƒæ‰§è¡Œ `bin` é…ç½®çš„å‘½ä»¤æ—¶ï¼Œä¼šå¯ç”¨ Node å»æ‰§è¡Œå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

> **æ¸©é¦¨æç¤º**ï¼šå¦‚æœ `bin` ä¸é…ç½®æ‰§è¡Œçš„å‘½ä»¤åç§°ï¼Œé»˜è®¤å°†ä½¿ç”¨`pageage.json` ä¸­çš„ `<name>` å­—æ®µä½œä¸ºå‘½ä»¤ã€‚

æ­¤æ—¶åœ¨ä»»æ„ä½ç½®æ‰§è¡Œ `rambo` å‘½ä»¤ï¼š

```shell
npm-module|â‡’ rambo
è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªnodeæ¨¡å—
```

## æ›´æ–°npmåŒ…

ä¿®æ”¹ç‰ˆæœ¬å·ä¹‹åï¼Œé‡æ–°publish

```shell
npm-module|â‡’ npm version 1.0.1
v1.0.1
npm-module|â‡’ npm publish
```

## å®‰è£…ä½¿ç”¨cli

é€šè¿‡ `npm install`  å‘½ä»¤å¯¹å·¥å…·è¿›è¡Œå…¨å±€å®‰è£…ï¼š

```
npm-module|â‡’ npm install npm-module -g
/usr/local/bin/npm-module -> /usr/local/lib/node_modules/npm-module/cli.js
+ npm-module@1.0.0
updated 1 package in 12.977s
å¤åˆ¶ä»£ç 
```

ç”±å®‰è£…æ‰“å°ä¿¡æ¯å¯ä»¥å‘ç°ï¼Œæœ€ç»ˆ CLI å·¥å…·è„šæœ¬é“¾æ¥æŒ‡å‘äº† `/usr/local/bin/npm-module` ã€‚å®‰è£…æˆåŠŸä¹‹åï¼Œå¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ CLI æŒ‡å®šçš„å‘½ä»¤äº†ã€‚

> å…¨å±€çš„npmåŒ…ä¼šå®‰è£…åœ¨/usr/local/lib/node_modules/ç›®å½•ä¸‹é¢

## é«˜é˜¶ä½¿ç”¨

ä¸Šé¢è®²è§£çš„åªæ˜¯ä¸€ä¸ªç®€å•çš„æ•™ç¨‹ç¤ºä¾‹ï¼Œä¸‹é¢ä¼šè®²è§£ä¸€ä¸ªç¤ºä¾‹ï¼Œç®—æ˜¯ç®€çº¦ç‰ˆæœ¬çš„[ESLint](https://cn.eslint.org/docs/user-guide/getting-started) [ESLint-github](https://github.com/eslint/eslint)ï¼Œç”¨äºæ£€æŸ¥`commit`æäº¤ä¿¡æ¯çš„è§„èŒƒå’Œæäº¤ä»£ç çš„æ ¼å¼åŒ–å¤„ç†ï¼Œå…¶ä¸­åŒºåˆ«æ•™ç¨‹ï¼Œè¿˜éœ€è¦è€ƒè™‘çš„åŠŸèƒ½å¦‚ä¸‹ï¼š

1. å¸®åŠ©ä¿¡æ¯æ‰“å°ï¼Œç”¨äºæ‰“å°æ”¯æŒçš„å‘½ä»¤ï¼Œé€‰é¡¹å‚æ•°ï¼Œæ¯”å¦‚ï¼š`rambo --help`
2. ç‰ˆæœ¬ä¿¡æ¯ï¼Œå‘ŠçŸ¥ä½¿ç”¨è€…å½“å‰çš„CLIç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š`rambo --version`
3. äº¤äº’é¢æ¿ï¼Œæä¾›ä½¿ç”¨è€…çš„å¯é€‰é¡¹æ“ä½œ
4. ä¿¡æ¯æ‰“å°ï¼Œæä¾›å„ç§è¯­ä¹‰é¢œè‰²æ‰“å°
5. é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œç”¨äºå†™å…¥æœ¬åœ°è¿›è¡Œçš„ä¸€ä¸ªé…ç½®é¡¹ç®¡ç†
6. httpè¯·æ±‚
7. git hookså®ç°commitçš„hook

å¤„ç†ä»¥ä¸ŠåŠŸèƒ½å°±éœ€è¦é¢å¤–çš„ä¾èµ–åº“ï¼Œå¦‚ä¸‹ï¼š

[commander](https://github.com/tj/commander.js)ï¼šå®Œæ•´çš„ [node.js](http://nodejs.org/) å‘½ä»¤è¡Œè§£å†³æ–¹æ¡ˆã€‚å®ç°1ã€2

[inquirer](https://github.com/SBoudrias/Inquirer.js)ï¼šå¸¸è§çš„UIäº¤äº’å¼å‘½ä»¤è¡Œé›†åˆã€‚å®ç°3

[colors](https://github.com/Marak/colors.js)ã€[chalk](https://github.com/chalk/chalk) - ç»™node.jsçš„æ§åˆ¶å°è¾“å‡ºæ·»åŠ é¢œè‰²å’Œæ ·å¼ã€‚å®ç°4

å†…ç½®æ¨¡å—fsï¼šæ–‡ä»¶æ“ä½œç³»ç»Ÿï¼Œè¯»å–æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæˆ–æ˜¯æ–°å»ºæ–‡ä»¶å¤¹

[child_process](https://www.runoob.com/nodejs/nodejs-process.html)ï¼šå­çº¿ç¨‹ï¼Œè°ƒç”¨execä½¿ç”¨å­è¿›ç¨‹æ‰§è¡Œå‘½ä»¤ã€‚

[nconf](https://github.com/indexzero/nconf#readme)ï¼šé…ç½®ç®¡ç†å·¥å…·ã€‚å¯ä»¥ç”¨jsonçš„å½¢å¼å°†é…ç½®ä¿¡æ¯å†™åœ¨å•ç‹¬çš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè¯»å–æ“ä½œã€‚[ä½¿ç”¨ä»‹ç»](https://leozcx.github.io/nconf-as-your-config-mgmt/)ã€‚å®ç°5

[request](https://github.com/request/request)ï¼šè½»é‡çš„httpè¯·æ±‚ã€‚å®ç°6ã€‚

### éƒ¨åˆ†ä»£ç æ¼”ç¤º

`cli.js`

```js
#!/usr/bin/env node
const program = require('commander');
const TestMain = require('./index');

const testMain = new TestMain();

program
    .version('1.0.0', '-v, --version')
    .option('-m, --message <msg>', 'è¾“å…¥æäº¤ä¿¡æ¯')
    .option('-t, --test', 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•å‘½ä»¤')
    .parse(process.argv);

const options = program.opts();
if (options.test) {
    testMain.run();
} else {
    console.log('test');
}
```

`index.js`

```js
#!/usr/bin/env node
const { exec } = require('child_process');
require('colors');
const fs = require('fs');
const nconf = require('nconf');
const inquirer = require('inquirer');
const request = require('request');

const cwd = process.cwd();
const home = process.env.HOME;
const testHome = `${cwd}/.test`;
const localConfig = `${cwd}/config.json`

class TestMain {
    constructor() {

    }

    createDirIfneed() {
        if (fs.existsSync(testHome)) {
            return;
        }
        fs.mkdirSync(testHome, null);
    }

    createLocalConfigIfneed() {
        /// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises
        return new Promise((resolve) => {
            if (!fs.existsSync(testHome)) {
                fs.mkdirSync(testHome, null);
            }
            nconf.argv().env().file({ file: localConfig });
            if (fs.existsSync(localConfig)) {
                resolve();
                return;
            }
            const questions = [
                {
                    type: 'rawlist',
                    name: 'where',
                    message: 'è¯·é€‰æ‹©ä½ çš„ç¥–å›½',
                    choices: [
                        'ä¸­å›½',
                        'ç¾å›½',
                        'æ—¥æœ¬'
                    ]
                }
            ];
            inquirer.prompt(questions).then((answers) => {
                nconf.set('where', answers.where);
                nconf.save();
                resolve();
            });
        });
    }
    
    async run() {
      this.createLocalConfigIfneed();
      await this.createLocalConfigIfneed();
    }
}

module.exports = TestMain;
```



## å‚è€ƒæ–‡ç« 

[ä¸€äº›å¸¸ç”¨çš„npmåŒ…](https://cnodejs.org/topic/5b10eef857137f22415c482a) [å¸¸ç”¨çš„å†…ç½®æ¨¡å—](https://wuyou91.github.io/node-modules-in-common-use/)

[svgç”Ÿæˆ](https://shields.io/) ![å›¾ç‰‡](https://raw.githubusercontent.com/RamboQiu/RamboQiu.github.io/master/resource/npm_module.svg)

[gité’©å­](https://www.ctolib.com/docs-Git-Chinese-Course-c-index.html)ï¼Œåœ¨.git/hooksæ–‡ä»¶å¤¹ä¸­

[ä½¿ç”¨NPMå‘å¸ƒå’Œä½¿ç”¨CLIå·¥å…·](https://juejin.cn/post/6844904153030852621#heading-4)

